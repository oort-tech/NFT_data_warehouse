(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.ItPushable = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var ItPushable=(()=>{var d=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var N=Object.prototype.hasOwnProperty;var S=(i,t)=>{for(var r in t)d(i,r,{get:t[r],enumerable:!0})},k=(i,t,r,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let u of L(t))!N.call(i,u)&&u!==r&&d(i,u,{get:()=>t[u],enumerable:!(e=z(t,u))||e.enumerable});return i};var _=i=>k(d({},"__esModule",{value:!0}),i);var I={};S(I,{pushable:()=>M,pushableV:()=>A});var f=class{constructor(t){if(!(t>0)||t-1&t)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}push(t){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=t,this.top=this.top+1&this.mask,!0)}shift(){let t=this.buffer[this.btm];if(t!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,t}isEmpty(){return this.buffer[this.btm]===void 0}},h=class{constructor(t={}){this.hwm=t.splitLimit??16,this.head=new f(this.hwm),this.tail=this.head,this.size=0}calculateSize(t){return t?.byteLength!=null?t.byteLength:1}push(t){if(t?.value!=null&&(this.size+=this.calculateSize(t.value)),!this.head.push(t)){let r=this.head;this.head=r.next=new f(2*this.head.buffer.length),this.head.push(t)}}shift(){let t=this.tail.shift();if(t===void 0&&this.tail.next!=null){let r=this.tail.next;this.tail.next=null,this.tail=r,t=this.tail.shift()}return t?.value!=null&&(this.size-=this.calculateSize(t.value)),t}isEmpty(){return this.head.isEmpty()}};function M(i={}){return p(r=>{let e=r.shift();if(e==null)return{done:!0};if(e.error!=null)throw e.error;return{done:e.done===!0,value:e.value}},i)}function A(i={}){return p(r=>{let e,u=[];for(;!r.isEmpty()&&(e=r.shift(),e!=null);){if(e.error!=null)throw e.error;e.done===!1&&u.push(e.value)}return e==null?{done:!0}:{done:e.done===!0,value:u}},i)}function p(i,t){t=t??{};let r=t.onEnd,e=new h,u,s,o,w=async()=>e.isEmpty()?o?{done:!0}:await new Promise((n,g)=>{s=E=>{s=null,e.push(E);try{n(i(e))}catch(v){g(v)}return u}}):i(e),c=n=>s!=null?s(n):(e.push(n),u),x=n=>(e=new h,s!=null?s({error:n}):(e.push({error:n}),u)),b=n=>{if(o)return u;if(t?.objectMode!==!0&&n?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return c({done:!1,value:n})},a=n=>o?u:(o=!0,n!=null?x(n):c({done:!0})),m=()=>(e=new h,a(),{done:!0}),y=n=>(a(n),{done:!0});if(u={[Symbol.asyncIterator](){return this},next:w,return:m,throw:y,push:b,end:a,get readableLength(){return e.size}},r==null)return u;let l=u;return u={[Symbol.asyncIterator](){return this},next(){return l.next()},throw(n){return l.throw(n),r!=null&&(r(n),r=void 0),{done:!0}},return(){return l.return(),r!=null&&(r(),r=void 0),{done:!0}},push:b,end(n){return l.end(n),r!=null&&(r(n),r=void 0),u},get readableLength(){return l.readableLength}},u}return _(I);})();
return ItPushable}));
